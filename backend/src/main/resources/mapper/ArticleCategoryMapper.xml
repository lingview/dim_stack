<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xyz.lingview.dimstack.mapper.ArticleCategoryMapper">

    <select id="findAllEnabledCategories" resultType="xyz.lingview.dimstack.domain.ArticleCategory">
        SELECT
            id,
            article_categories AS article_categories,
            categories_explain AS categories_explain,
            founder,
            create_time AS create_time,
            status
        FROM article_categories
        WHERE status = 1
    </select>

    <select id="findAllEnabledCategoriesAndCount" resultType="xyz.lingview.dimstack.domain.ArticleCategoryAndCount">
        SELECT
            ac.id,
            ac.article_categories AS article_categories,
            ac.categories_explain AS categories_explain,
            ac.founder,
            ac.create_time AS create_time,
            ac.status,
            COUNT(a.id) AS articleCount
        FROM article_categories ac
        LEFT JOIN article a ON ac.article_categories = a.category
            AND a.status = 1
        WHERE ac.status = 1
        GROUP BY ac.id, ac.article_categories, ac.categories_explain, ac.founder, ac.create_time, ac.status
        ORDER BY ac.create_time DESC
    </select>

    <select id="findArticlesByCategory" resultType="xyz.lingview.dimstack.dto.ArticleDTO">
        SELECT
            a.id,
            a.article_id,
            a.article_name AS title,
            a.excerpt,
            a.article_cover AS image,
            a.create_time AS date,
            u.username AS author,
            a.category,
            a.alias
        FROM article a
        LEFT JOIN user_information u ON a.uuid = u.uuid
        WHERE a.category = #{category}
          AND a.status = 1
        ORDER BY a.create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <select id="countArticlesByCategory" resultType="int">
        SELECT COUNT(*)
        FROM article
        WHERE category = #{category}
          AND status = 1
    </select>
</mapper>
