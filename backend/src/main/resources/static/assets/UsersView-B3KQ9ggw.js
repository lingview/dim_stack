import{r as a,a as c,j as e,g as R}from"./index-D41_mKPG.js";const U=s=>{if(!s)return null;if(s.startsWith("http://")||s.startsWith("https://"))return s;try{return R().getFullUrl(s)}catch{return s.startsWith("/")?s:`/upload/${s}`}};function E(){const[s,i]=a.useState([]),[j,y]=a.useState([]),[m,h]=a.useState(!0),[u,d]=a.useState(""),[l,g]=a.useState(null),[b,n]=a.useState(!1),[p,f]=a.useState("");a.useEffect(()=>{o(),N()},[]);const o=async()=>{try{h(!0);const t=await c.get("/user/list");i(t||[])}catch{d("获取用户列表失败")}finally{h(!1)}},N=async()=>{try{const t=await c.get("/user/roles");y(t||[])}catch{}},w=async(t,r)=>{try{await c.post("/user/updateRole",null,{params:{userId:t,roleId:r}}),o(),n(!1),g(null)}catch{d("更新用户角色失败")}},x=async(t,r)=>{try{await c.post("/user/updateStatus",null,{params:{userId:t,status:r}}),o()}catch{d("更新用户状态失败")}},v=t=>{g(t),f(t.role_id),n(!0)},k=t=>{switch(t){case 0:return"已删除";case 1:return"正常";case 2:return"已封禁";default:return"未知"}},C=t=>{switch(t){case 0:return"bg-red-100 text-red-800";case 1:return"bg-green-100 text-green-800";case 2:return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return m?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"用户管理"})}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"用户管理"})}),u&&e.jsx("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg mb-6",children:u}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用户名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"角色"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"注册时间"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:U(t.avatar),alt:t.username,onError:r=>{r.target.src="/image_error.svg"}})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.username}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email||t.phone||"未提供联系方式"})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.role_name||"未分配"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.role_code||""})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.create_time?new Date(t.create_time).toLocaleDateString():"未知"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${C(t.status)}`,children:k(t.status)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>v(t),className:"text-blue-600 hover:text-blue-900 mr-4",children:"更改角色"}),t.status===1&&e.jsx("button",{onClick:()=>x(t.id,2),className:"text-yellow-600 hover:text-yellow-900 mr-4",children:"封禁"}),t.status===2&&e.jsx("button",{onClick:()=>x(t.id,1),className:"text-green-600 hover:text-green-900 mr-4",children:"解封"}),t.status!==0&&e.jsx("button",{onClick:()=>x(t.id,0),className:"text-red-600 hover:text-red-900",children:"删除"})]})]},t.id))})]}),s.length===0&&!m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"暂无用户"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"还没有用户注册"})]})]}),b&&l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-transparent z-40",onClick:()=>n(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md shadow-xl",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"更改用户角色"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["用户: ",l.username]}),e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["当前角色: ",l.role_name]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"选择新角色:"}),e.jsx("select",{value:p,onChange:t=>f(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:j.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.code,")"]},t.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:()=>w(l.id,p),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"确认更改"})]})]})})]})]})}export{E as default};
