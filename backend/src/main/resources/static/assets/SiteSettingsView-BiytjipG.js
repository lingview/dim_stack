import{r as l,a as m,j as e,g as M}from"./index-FGfFof8b.js";const U=s=>{if(!s)return null;if(s.startsWith("http://")||s.startsWith("https://"))return s;try{return M().getFullUrl(s)}catch{return s.startsWith("/")?s:`/upload/${s}`}},u=s=>s&&s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),c=s=>s&&s.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'");function $(){const[s,x]=l.useState(!0),[y,_]=l.useState(!1),[j,v]=l.useState(!1),[N,w]=l.useState(!1),[k,I]=l.useState([]),[R,D]=l.useState([]),p=l.useRef(null),g=l.useRef(null),[r,f]=l.useState({site_name:"",copyright:"",hero_title:"",hero_subtitle:"",hero_image:"",site_icon:"",register_user_permission:"2",article_status:3,expansion_server:""}),[b,C]=l.useState({type:"",content:""});l.useEffect(()=>{Promise.all([q(),E(),O()]).finally(()=>{x(!1)})},[]);const q=async()=>{try{const t=await m.get("/site/getsiteconfig");if(t.success){const a={...t.data,site_name:u(t.data.site_name)||"",copyright:u(t.data.copyright)||"",hero_title:u(t.data.hero_title)||"",hero_subtitle:u(t.data.hero_subtitle)||"",hero_image:t.data.hero_image||"",site_icon:t.data.site_icon||""};f(a)}else o("error",t.message||"获取站点配置失败")}catch{o("error","获取站点配置时发生错误")}},E=async()=>{try{const t=await m.get("/site/roles");if(t.success){const a=t.data.map(n=>({...n,name:u(n.name)||"",description:u(n.description)||""}));I(a)}else o("error",t.message||"获取角色列表失败")}catch{o("error","获取角色列表时发生错误")}},O=async()=>{try{const t=await m.get("/site/article-status-options");if(t.success){const a=t.data.map(n=>({...n,label:u(n.label)||""}));D(a)}else o("error",t.message||"获取文章状态选项失败")}catch{o("error","获取文章状态选项时发生错误")}},d=t=>{const{name:a,value:n}=t.target,i=u(n);f(h=>({...h,[a]:i}))},L=async t=>{t.preventDefault();try{_(!0);const a={...r,site_name:c(r.site_name),copyright:c(r.copyright),hero_title:c(r.hero_title),hero_subtitle:c(r.hero_subtitle)},n=await m.post("/site/editsiteconfig",a);n.success?o("success","站点配置保存成功"):o("error",n.message||"保存失败")}catch{o("error","保存站点配置时发生错误")}finally{_(!1)}},T=async t=>{const a=t.target.files[0];if(!a)return;const n=new FormData;n.append("file",a);try{v(!0);const i=await m.post("/uploadattachment",n,{headers:{"Content-Type":"multipart/form-data"}});i.fileUrl?(f(h=>({...h,hero_image:i.fileUrl})),o("success","图片上传成功")):o("error",i.error||"图片上传失败")}catch{o("error","图片上传时发生错误")}finally{v(!1),p.current&&(p.current.value="")}},W=async t=>{const a=t.target.files[0];if(!a)return;const n=new FormData;n.append("file",a);try{w(!0);const i=await m.post("/uploadattachment",n,{headers:{"Content-Type":"multipart/form-data"}});i.fileUrl?(f(h=>({...h,site_icon:i.fileUrl})),o("success","站点图标上传成功")):o("error",i.error||"站点图标上传失败")}catch{o("error","站点图标上传时发生错误")}finally{w(!1),g.current&&(g.current.value="")}},A=()=>{p.current&&p.current.click()},H=()=>{g.current&&g.current.click()},o=(t,a)=>{C({type:t,content:a}),setTimeout(()=>{C({type:"",content:""})},3e3)};if(s)return e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})});const S=r.hero_image?U(r.hero_image):null,F=r.site_icon?U(r.site_icon):null;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"站点信息设置"}),b.content&&e.jsx("div",{className:`mb-6 p-4 rounded-lg ${b.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:b.content}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"site_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"站点名称"}),e.jsx("input",{type:"text",id:"site_name",name:"site_name",value:c(r.site_name),onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"copyright",className:"block text-sm font-medium text-gray-700 mb-1",children:"版权信息"}),e.jsx("input",{type:"text",id:"copyright",name:"copyright",value:c(r.copyright),onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"hero_title",className:"block text-sm font-medium text-gray-700 mb-1",children:"首页标题"}),e.jsx("input",{type:"text",id:"hero_title",name:"hero_title",value:c(r.hero_title),onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"hero_subtitle",className:"block text-sm font-medium text-gray-700 mb-1",children:"首页副标题"}),e.jsx("textarea",{id:"hero_subtitle",name:"hero_subtitle",value:c(r.hero_subtitle),onChange:d,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"首页头图"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",id:"hero_image",name:"hero_image",value:r.hero_image,onChange:d,placeholder:"点击上传按钮或输入图片URL",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("input",{type:"file",ref:p,onChange:T,accept:"image/*",className:"hidden"})]}),e.jsx("button",{type:"button",onClick:A,disabled:j,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:j?"上传中...":"上传图片"})]}),S&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:S,alt:"首页头图预览",className:"max-w-full h-48 object-cover rounded-md",onError:t=>{t.target.src="/default-image.png"}})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"站点图标"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",id:"site_icon",name:"site_icon",value:r.site_icon,onChange:d,placeholder:"点击上传按钮或输入图标URL",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"file",ref:g,onChange:W,accept:"image/*",className:"hidden"})]}),e.jsx("button",{type:"button",onClick:H,disabled:N,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:N?"上传中...":"上传图标"})]}),F&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:F,alt:"站点图标预览",className:"w-16 h-16 object-contain rounded-md",onError:t=>{t.target.src="/default-icon.png"}})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"register_user_permission",className:"block text-sm font-medium text-gray-700 mb-1",children:"注册用户默认角色"}),e.jsx("select",{id:"register_user_permission",name:"register_user_permission",value:r.register_user_permission,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:k.map(t=>e.jsx("option",{value:t.id,children:c(t.name)},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"article_status",className:"block text-sm font-medium text-gray-700 mb-1",children:"文章默认状态"}),e.jsx("select",{id:"article_status",name:"article_status",value:r.article_status,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:R.map(t=>e.jsx("option",{value:t.value,children:c(t.label)},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"expansion_server",className:"block text-sm font-medium text-gray-700 mb-1",children:"扩展服务器地址"}),e.jsx("input",{type:"text",id:"expansion_server",name:"expansion_server",value:c(r.expansion_server),onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入扩展服务器地址"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:y,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:y?"保存中...":"保存设置"})})]})]})}export{$ as default};
