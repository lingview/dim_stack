import{r as d,a as w,j as e}from"./index-BCEYEMy3.js";function W(){const[k,g]=d.useState([]),[_,C]=d.useState(!0),[l,M]=d.useState(1),[c,b]=d.useState(0),[o]=d.useState(10),[z,j]=d.useState(null),[R,v]=d.useState(!1),[s,m]=d.useState(null),[D,S]=d.useState(!1),[h,A]=d.useState("pending");d.useEffect(()=>{L(l,o)},[l,o,h]);const E=t=>{if(!t)return"";try{const r=document.createElement("div");r.innerHTML=t,["p","div","h1","h2","h3","h4","h5","h6","br","hr","li","blockquote"].forEach(n=>{r.querySelectorAll(n).forEach(u=>{if(n==="br")u.replaceWith(`
`);else if(n==="hr")u.replaceWith(`
---
`);else if(n==="li"){const y=u.textContent||"";u.replaceWith(`• ${y}
`)}else{const y=u.textContent||"";y.trim()&&u.replaceWith(`${y}

`)}})});let i=r.textContent||r.innerText||"";return i=i.replace(/\n\s*\n\s*\n/g,`

`).replace(/^\s+|\s+$/g,"").replace(/[ \t]+/g," "),i}catch{return t.replace(/<[^>]*>/g,"").replace(/&[^;]+;/g," ")}},L=async(t,r)=>{C(!0);try{const a=h==="pending"?"/articlereview/getarticlelist":"/articlereview/getallarticles",n=await w.get(a,{params:{page:t,size:r}});n&&n.code===200&&n.data&&Array.isArray(n.data.articles)?(g(n.data.articles),b(Math.ceil((n.data.total||n.data.articles.length)/(n.data.size||r)))):(g([]),b(0))}catch{g([]),b(0)}finally{C(!1)}},x=t=>{t<1||t>c||M(t)},B=async t=>{S(!0),v(!0),j(t);try{const a=await w.get("/articlereview/getarticlecontent",{params:{articleId:t}});if(a&&a.code===200&&a.data){const i=E(a.data.article_content||"");m({...a.data,article_content:i})}else m(null)}catch{m(null)}finally{S(!1)}},p=async(t,r)=>{try{const i=await w.post("/articlereview/articlestatus",{articleId:t,status:r});if(i&&i.code===200&&i.data&&i.data.success)g(n=>n.map(f=>f.article_id===t?{...f,status:r}:f)),s&&s.article_id===t&&m(n=>({...n,status:r})),alert("文章状态更新成功"),r!==3&&(v(!1),j(null),m(null),L(l,o));else throw new Error("后端返回失败或 success=false")}catch{alert("更新文章状态失败")}},N=()=>{v(!1),j(null),m(null)},F=()=>{A(t=>t==="pending"?"all":"pending"),M(1)};return _?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"文章审核"})}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"文章审核"}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",children:h==="pending"?"查看全部文章":"仅查看待审核"})]}),k.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:h==="pending"?"暂无需要审核的文章":"暂无文章"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"文章标题"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"作者"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"分类"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"标签"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"创建时间"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(t=>e.jsxs("tr",{className:z===t.article_id?"bg-blue-50":"",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.article_name}),e.jsx("div",{className:"text-sm text-gray-500 line-clamp-1",children:t.excerpt})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.author_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.category}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.tag}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.create_time).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.status===1?"bg-green-100 text-green-800":t.status===2?"bg-yellow-100 text-yellow-800":t.status===3?"bg-blue-100 text-blue-800":t.status===0?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:t.status===1?"已发布":t.status===2?"未发布":t.status===3?"待审核":t.status===0?"已删除":"违规"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>B(t.article_id),className:"text-blue-600 hover:text-blue-900 mr-3",children:"查看"}),h==="all"&&t.status!==3&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(t.article_id,3),className:"text-yellow-600 hover:text-yellow-900 mr-3",children:"设为待审核"}),e.jsx("button",{onClick:()=>p(t.article_id,4),className:"text-red-600 hover:text-red-900",disabled:t.status===4,children:"标记违规"})]})]})]},t.article_id))})]})}),c>1&&e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-4",children:[e.jsxs("div",{className:"flex flex-1 justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>x(l-1),disabled:l===1,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),e.jsx("button",{onClick:()=>x(l+1),disabled:l===c,className:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["显示第 ",e.jsx("span",{className:"font-medium",children:(l-1)*o+1})," 到 ",e.jsx("span",{className:"font-medium",children:Math.min(l*o,c*o)})," 条结果，共 ",e.jsx("span",{className:"font-medium",children:c*o})," 条"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>x(1),disabled:l===1,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"首页"}),e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414zm-6 0a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 011.414 1.414L5.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})})]}),e.jsxs("button",{onClick:()=>x(l-1),disabled:l===1,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"上一页"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"})})]}),(()=>{const r=[];for(let a=Math.max(2,l-2);a<=Math.min(c-1,l+2);a++)r.push(a);return l-2>2&&r.unshift("..."),l+2<c-1&&r.push("..."),[1,...r,c].map((a,i)=>e.jsx("button",{onClick:()=>typeof a=="number"&&x(a),disabled:a==="..."||a===l,className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${a===l?"z-10 bg-blue-600 text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":a==="..."?"text-gray-700":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"}`,children:a},i))})(),e.jsxs("button",{onClick:()=>x(l+1),disabled:l===c,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"下一页"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})]}),e.jsxs("button",{onClick:()=>x(c),disabled:l===c,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"末页"}),e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414zm6 0a1 1 0 011.414 0l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414-1.414L14.586 10l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})})]})]})]}),R&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",onClick:N,children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-md transition-opacity","aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[95vh] overflow-hidden flex flex-col",onClick:t=>t.stopPropagation(),role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"文章详情预览"}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-500 transition-colors","aria-label":"关闭",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),D?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):s?e.jsxs("div",{className:"overflow-y-auto flex-1",children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4 border-b border-gray-200 pb-2",children:s.article_name}),e.jsxs("div",{className:"flex flex-wrap items-center text-sm text-gray-600 mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:"状态:"}),e.jsx("span",{className:`ml-2 px-3 py-1 rounded-full text-xs font-medium ${s.status===1?"bg-green-100 text-green-800":s.status===2?"bg-yellow-100 text-yellow-800":s.status===3?"bg-blue-100 text-blue-800":s.status===0?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:s.status===1?"已发布":s.status===2?"未发布":s.status===3?"待审核":s.status===0?"已删除":"违规"})]}),s.category&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:"分类:"}),e.jsx("span",{className:"ml-1 px-2 py-1 bg-gray-100 rounded text-xs",children:s.category})]}),s.tag&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:"标签:"}),e.jsx("span",{className:"ml-1 px-2 py-1 bg-gray-100 rounded text-xs",children:s.tag})]})]}),s.excerpt&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"文章摘要"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.excerpt})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"文章正文"}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 max-h-96 overflow-y-auto",children:e.jsx("div",{className:"text-gray-800 leading-relaxed text-sm whitespace-pre-wrap font-mono break-words",style:{fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"14px",lineHeight:"1.6"},children:s.article_content||"无内容"})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["字符数: ",(s.article_content||"").length]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3",children:[s.status===3&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(s.article_id,1),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors",children:"通过审核"}),e.jsx("button",{onClick:()=>p(s.article_id,4),className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors",children:"标记违规"})]}),e.jsx("button",{onClick:N,className:"px-6 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors",children:"关闭"})]})]}):e.jsxs("div",{className:"flex flex-col justify-center items-center h-64",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-gray-500",children:"无法加载文章详情"})]})]})]})]})}export{W as default};
