import{r as i,a,j as e}from"./index-BPpV9lHM.js";function B(){const[u,k]=i.useState([]),[h,T]=i.useState([]),[L,g]=i.useState(!1),[f,p]=i.useState(!1),[r,j]=i.useState(null),[S,o]=i.useState(!1),[y,b]=i.useState(!1),[d,n]=i.useState({type:"",text:""});i.useEffect(()=>{l()},[]);const l=async()=>{try{g(!0);const s=await a.get("/theme/list"),t=$(s);k(t)}catch{n({type:"error",text:"获取本地主题列表失败"})}finally{g(!1)}},$=s=>{const t=s.split(`
`),c=[];for(let x=1;x<t.length;x++){const v=t[x].trim();if(v.startsWith("- ")){const P=v.substring(2),[w,C]=P.split(" ("),W=C&&C.includes("current");c.push({name:w,slug:w,isCurrent:W,type:"local"})}}return c},M=async()=>{try{p(!0);const s=await a.post("/getthemeslist");if(s.success){const t=Array.isArray(s.data)?s.data:[];T(t),n({type:"success",text:"云端主题列表获取成功"})}else n({type:"error",text:s.message||"获取云端主题列表失败"})}catch{n({type:"error",text:"获取云端主题列表失败"})}finally{p(!1)}},N=async s=>{try{b(!0);const t=await a.post("/gettheme",{slug:s});t.success?(n({type:"success",text:`主题 ${s} 安装成功`}),l(),o(!1)):n({type:"error",text:t.message||`安装主题 ${s} 失败`})}catch(t){n({type:"error",text:`安装主题失败: ${t.message}`})}finally{b(!1)}},_=async s=>{if(window.confirm(`确定要删除主题 "${s}" 吗？`))try{const t=await a.post("/deletetheme",{slug:s});t.success?(n({type:"success",text:`主题 ${s} 删除成功`}),l()):n({type:"error",text:t.message||`删除主题 ${s} 失败`})}catch(t){n({type:"error",text:`删除主题失败: ${t.message}`})}},V=async s=>{try{const t=await a.post(`/theme/switch?themeName=${s}`);t.includes("successfully")?(n({type:"success",text:`主题已切换为 ${s}`}),l()):n({type:"error",text:t})}catch(t){n({type:"error",text:`切换主题失败: ${t.message}`})}},z=s=>{j(s),o(!0)},m=()=>{o(!1),j(null)};return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"主题商店"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"管理本地主题和获取云端主题"})]}),d.text&&e.jsx("div",{className:`mb-6 p-4 rounded-md ${d.type==="error"?"bg-red-50 text-red-800":"bg-green-50 text-green-800"}`,children:d.text}),e.jsxs("div",{className:"bg-white shadow rounded-lg mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"本地主题"})})}),e.jsx("div",{className:"p-6",children:L?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):u.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"暂无本地主题"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),s.isCurrent&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 mt-1",children:"当前使用"})]})}),e.jsxs("div",{className:"mt-4 flex space-x-2",children:[!s.isCurrent&&e.jsx("button",{onClick:()=>V(s.slug),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"使用"}),e.jsx("button",{onClick:()=>_(s.slug),disabled:s.isCurrent,className:`inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white ${s.isCurrent?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500`,children:"删除"})]})]})},s.slug))})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"云端主题"}),e.jsx("button",{onClick:M,disabled:f,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"获取中..."]}):"获取云端主题"})]})}),e.jsx("div",{className:"p-6",children:h.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"暂无云端主题"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"点击上方按钮获取云端主题列表"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"aspect-w-16 aspect-h-9 bg-gray-100",children:s.preview_url?e.jsx("img",{src:s.preview_url,alt:s.name,className:"object-cover w-full h-48 cursor-pointer",onClick:()=>z(s)}):e.jsx("div",{className:"bg-gray-200 border-2 border-dashed rounded-xl w-full h-48 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500",children:"无预览图"})})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.tags&&s.tags.map((t,c)=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:t},c))}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:s.version}),e.jsx("button",{onClick:()=>N(s.slug),disabled:y,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:y?"安装中...":"安装"})]})]})]},s.slug))})})]}),S&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-full overflow-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:r.description})]}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mt-4",children:r.preview_url?e.jsx("img",{src:r.preview_url,alt:r.name,className:"w-full rounded-lg"}):e.jsx("div",{className:"bg-gray-200 border-2 border-dashed rounded-xl w-full h-96 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500",children:"无预览图"})})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"作者"}),e.jsx("p",{className:"text-sm text-gray-500",children:r.author})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"版本"}),e.jsx("p",{className:"text-sm text-gray-500",children:r.version})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"文件大小"}),e.jsx("p",{className:"text-sm text-gray-500",children:r.file_size})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"上传时间"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(r.upload_time).toLocaleDateString()})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"标签"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:r.tags&&r.tags.map((s,t)=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:s},t))})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx("button",{onClick:m,className:"mr-3 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"关闭"}),e.jsx("button",{onClick:()=>{N(r.slug),m()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"安装主题"})]})]})})})]})}export{B as default};
