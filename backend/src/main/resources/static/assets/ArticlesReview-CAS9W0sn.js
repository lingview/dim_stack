import{r as n,a as v,j as e}from"./index-DjqJMg_w.js";function T(){const[N,h]=n.useState([]),[_,w]=n.useState(!0),[i,L]=n.useState(1),[o,p]=n.useState(0),[f]=n.useState(10),[M,y]=n.useState(null),[A,b]=n.useState(!1),[s,d]=n.useState(null),[D,k]=n.useState(!1);n.useEffect(()=>{C(i,f)},[i,f]);const z=t=>{if(!t)return"";try{const a=document.createElement("div");a.innerHTML=t,["p","div","h1","h2","h3","h4","h5","h6","br","hr","li","blockquote"].forEach(c=>{a.querySelectorAll(c).forEach(x=>{if(c==="br")x.replaceWith(`
`);else if(c==="hr")x.replaceWith(`
---
`);else if(c==="li"){const g=x.textContent||"";x.replaceWith(`• ${g}
`)}else{const g=x.textContent||"";g.trim()&&x.replaceWith(`${g}

`)}})});let l=a.textContent||a.innerText||"";return l=l.replace(/\n\s*\n\s*\n/g,`

`).replace(/^\s+|\s+$/g,"").replace(/[ \t]+/g," "),l}catch{return t.replace(/<[^>]*>/g,"").replace(/&[^;]+;/g," ")}},C=async(t,a)=>{w(!0);try{const r=await v.get("/articlereview/getarticlelist",{params:{page:t,size:a}}),l=r.data??r;l&&Array.isArray(l.articles)?(h(l.articles),p(Math.ceil((l.total||l.articles.length)/(l.size||a)))):(h([]),p(0))}catch{h([]),p(0)}finally{w(!1)}},m=t=>{t<1||t>o||L(t)},E=async t=>{k(!0),b(!0),y(t);try{const a=await v.get("/articlereview/getarticlecontent",{params:{articleId:t}}),r=a.data??a;if(r){const l=z(r.article_content||"");d({...r,article_content:l})}else d(null)}catch{d(null)}finally{k(!1)}},S=async(t,a)=>{try{const r=await v.post("/articlereview/articlestatus",{articleId:t,status:a}),l=r.data??r;if(l&&l.success)h(c=>c.map(u=>u.article_id===t?{...u,status:a}:u)),s&&s.article_id===t&&d(c=>({...c,status:a})),alert("文章状态更新成功"),a!==3&&(b(!1),y(null),d(null),C(i,f));else throw new Error("后端返回失败或 success=false")}catch{alert("更新文章状态失败")}},j=()=>{b(!1),y(null),d(null)};return _?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"文章审核"})}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"文章审核"})}),N.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"暂无需要审核的文章"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"文章标题"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"作者"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"分类"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"标签"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"创建时间"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(t=>e.jsxs("tr",{className:M===t.article_id?"bg-blue-50":"",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.article_name}),e.jsx("div",{className:"text-sm text-gray-500 line-clamp-1",children:t.excerpt})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.author_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.category}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.tag}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.create_time).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>E(t.article_id),className:"text-blue-600 hover:text-blue-900 mr-3",children:"查看"})})]},t.article_id))})]})}),o>1&&e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-4",children:[e.jsxs("div",{className:"flex flex-1 justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>m(i-1),disabled:i===1,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),e.jsx("button",{onClick:()=>m(i+1),disabled:i===o,className:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["第 ",e.jsx("span",{className:"font-medium",children:i})," 页，共 ",e.jsx("span",{className:"font-medium",children:o})," 页"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>m(i-1),disabled:i===1,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"上一页"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"})})]}),[...Array(o)].map((t,a)=>{const r=a+1;return e.jsx("button",{onClick:()=>m(r),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${i===r?"z-10 bg-blue-600 text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"}`,children:r},r)}),e.jsxs("button",{onClick:()=>m(i+1),disabled:i===o,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"下一页"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})]})]})})]})]})]}),A&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",onClick:j,children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-md transition-opacity","aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[95vh] overflow-hidden flex flex-col",onClick:t=>t.stopPropagation(),role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"文章详情预览"}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-500 transition-colors","aria-label":"关闭",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),D?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):s?e.jsxs("div",{className:"overflow-y-auto flex-1",children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4 border-b border-gray-200 pb-2",children:s.article_name}),e.jsxs("div",{className:"flex flex-wrap items-center text-sm text-gray-600 mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:"状态:"}),e.jsx("span",{className:`ml-2 px-3 py-1 rounded-full text-xs font-medium ${s.status===1?"bg-green-100 text-green-800":s.status===2?"bg-yellow-100 text-yellow-800":s.status===3?"bg-blue-100 text-blue-800":s.status===0?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:s.status===1?"已发布":s.status===2?"未发布":s.status===3?"待审核":s.status===0?"已删除":"违规"})]}),s.category&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:"分类:"}),e.jsx("span",{className:"ml-1 px-2 py-1 bg-gray-100 rounded text-xs",children:s.category})]}),s.tag&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:"标签:"}),e.jsx("span",{className:"ml-1 px-2 py-1 bg-gray-100 rounded text-xs",children:s.tag})]})]}),s.excerpt&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"文章摘要"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.excerpt})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"文章正文"}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 max-h-96 overflow-y-auto",children:e.jsx("div",{className:"text-gray-800 leading-relaxed text-sm whitespace-pre-wrap font-mono break-words",style:{fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"14px",lineHeight:"1.6"},children:s.article_content||"无内容"})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["字符数: ",(s.article_content||"").length]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3",children:[s.status===3&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>S(s.article_id,1),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors",children:"通过审核"}),e.jsx("button",{onClick:()=>S(s.article_id,4),className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors",children:"标记违规"})]}),e.jsx("button",{onClick:j,className:"px-6 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors",children:"关闭"})]})]}):e.jsxs("div",{className:"flex flex-col justify-center items-center h-64",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-gray-500",children:"无法加载文章详情"})]})]})]})]})}export{T as default};
