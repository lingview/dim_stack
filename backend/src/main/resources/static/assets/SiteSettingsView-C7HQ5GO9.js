import{r as l,a as m,j as e,g as M}from"./index-DVFXNS5z.js";const F=s=>{if(!s)return null;if(s.startsWith("http://")||s.startsWith("https://"))return s;try{return M().getFullUrl(s)}catch{return s.startsWith("/")?s:`/upload/${s}`}},d=s=>s&&s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),c=s=>s&&s.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'");function $(){const[s,b]=l.useState(!0),[y,_]=l.useState(!1),[j,v]=l.useState(!1),[N,w]=l.useState(!1),[k,I]=l.useState([]),[R,D]=l.useState([]),g=l.useRef(null),p=l.useRef(null),[a,f]=l.useState({site_name:"",copyright:"",hero_title:"",hero_subtitle:"",hero_image:"",site_icon:"",register_user_permission:"2",article_status:3}),[x,C]=l.useState({type:"",content:""});l.useEffect(()=>{Promise.all([q(),E(),O()]).finally(()=>{b(!1)})},[]);const q=async()=>{try{const t=await m.get("/site/getsiteconfig");if(t.success){const r={...t.data,site_name:d(t.data.site_name)||"",copyright:d(t.data.copyright)||"",hero_title:d(t.data.hero_title)||"",hero_subtitle:d(t.data.hero_subtitle)||"",hero_image:t.data.hero_image||"",site_icon:t.data.site_icon||""};f(r)}else i("error",t.message||"获取站点配置失败")}catch{i("error","获取站点配置时发生错误")}},E=async()=>{try{const t=await m.get("/site/roles");if(t.success){const r=t.data.map(n=>({...n,name:d(n.name)||"",description:d(n.description)||""}));I(r)}else i("error",t.message||"获取角色列表失败")}catch{i("error","获取角色列表时发生错误")}},O=async()=>{try{const t=await m.get("/site/article-status-options");if(t.success){const r=t.data.map(n=>({...n,label:d(n.label)||""}));D(r)}else i("error",t.message||"获取文章状态选项失败")}catch{i("error","获取文章状态选项时发生错误")}},u=t=>{const{name:r,value:n}=t.target,o=d(n);f(h=>({...h,[r]:o}))},L=async t=>{t.preventDefault();try{_(!0);const r={...a,site_name:c(a.site_name),copyright:c(a.copyright),hero_title:c(a.hero_title),hero_subtitle:c(a.hero_subtitle)},n=await m.post("/site/editsiteconfig",r);n.success?i("success","站点配置保存成功"):i("error",n.message||"保存失败")}catch{i("error","保存站点配置时发生错误")}finally{_(!1)}},T=async t=>{const r=t.target.files[0];if(!r)return;const n=new FormData;n.append("file",r);try{v(!0);const o=await m.post("/uploadattachment",n,{headers:{"Content-Type":"multipart/form-data"}});o.fileUrl?(f(h=>({...h,hero_image:o.fileUrl})),i("success","图片上传成功")):i("error",o.error||"图片上传失败")}catch{i("error","图片上传时发生错误")}finally{v(!1),g.current&&(g.current.value="")}},W=async t=>{const r=t.target.files[0];if(!r)return;const n=new FormData;n.append("file",r);try{w(!0);const o=await m.post("/uploadattachment",n,{headers:{"Content-Type":"multipart/form-data"}});o.fileUrl?(f(h=>({...h,site_icon:o.fileUrl})),i("success","站点图标上传成功")):i("error",o.error||"站点图标上传失败")}catch{i("error","站点图标上传时发生错误")}finally{w(!1),p.current&&(p.current.value="")}},A=()=>{g.current&&g.current.click()},H=()=>{p.current&&p.current.click()},i=(t,r)=>{C({type:t,content:r}),setTimeout(()=>{C({type:"",content:""})},3e3)};if(s)return e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})});const S=a.hero_image?F(a.hero_image):null,U=a.site_icon?F(a.site_icon):null;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"站点信息设置"}),x.content&&e.jsx("div",{className:`mb-6 p-4 rounded-lg ${x.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:x.content}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"site_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"站点名称"}),e.jsx("input",{type:"text",id:"site_name",name:"site_name",value:c(a.site_name),onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"copyright",className:"block text-sm font-medium text-gray-700 mb-1",children:"版权信息"}),e.jsx("input",{type:"text",id:"copyright",name:"copyright",value:c(a.copyright),onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"hero_title",className:"block text-sm font-medium text-gray-700 mb-1",children:"首页标题"}),e.jsx("input",{type:"text",id:"hero_title",name:"hero_title",value:c(a.hero_title),onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"hero_subtitle",className:"block text-sm font-medium text-gray-700 mb-1",children:"首页副标题"}),e.jsx("textarea",{id:"hero_subtitle",name:"hero_subtitle",value:c(a.hero_subtitle),onChange:u,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"首页头图"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",id:"hero_image",name:"hero_image",value:a.hero_image,onChange:u,placeholder:"点击上传按钮或输入图片URL",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("input",{type:"file",ref:g,onChange:T,accept:"image/*",className:"hidden"})]}),e.jsx("button",{type:"button",onClick:A,disabled:j,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:j?"上传中...":"上传图片"})]}),S&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:S,alt:"首页头图预览",className:"max-w-full h-48 object-cover rounded-md",onError:t=>{t.target.src="/default-image.png"}})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"站点图标"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",id:"site_icon",name:"site_icon",value:a.site_icon,onChange:u,placeholder:"点击上传按钮或输入图标URL",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"file",ref:p,onChange:W,accept:"image/*",className:"hidden"})]}),e.jsx("button",{type:"button",onClick:H,disabled:N,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:N?"上传中...":"上传图标"})]}),U&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:U,alt:"站点图标预览",className:"w-16 h-16 object-contain rounded-md",onError:t=>{t.target.src="/default-icon.png"}})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"register_user_permission",className:"block text-sm font-medium text-gray-700 mb-1",children:"注册用户默认角色"}),e.jsx("select",{id:"register_user_permission",name:"register_user_permission",value:a.register_user_permission,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:k.map(t=>e.jsx("option",{value:t.id,children:c(t.name)},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"article_status",className:"block text-sm font-medium text-gray-700 mb-1",children:"文章默认状态"}),e.jsx("select",{id:"article_status",name:"article_status",value:a.article_status,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:R.map(t=>e.jsx("option",{value:t.value,children:c(t.label)},t.value))})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:y,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:y?"保存中...":"保存设置"})})]})]})}export{$ as default};
